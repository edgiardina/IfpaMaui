<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Ifpa.Views.SettingsPage"
             xmlns:controls="clr-namespace:Ifpa.Controls"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
             xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
             xmlns:shimmer="clr-namespace:Syncfusion.Maui.Toolkit.Shimmer;assembly=Syncfusion.Maui.Toolkit"
             Title="{x:Static local:Strings.SettingsPage_Settings}"
             xmlns:local="clr-namespace:Ifpa"
             xmlns:vm="clr-namespace:Ifpa.ViewModels"
             x:DataType="vm:SettingsViewModel">
    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:IsNotNullConverter x:Key="notNullConverter" />
            <toolkit:IsNullConverter x:Key="nullConverter" />
            <toolkit:InvertedBoolConverter x:Key="invertedBoolConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Content>
        <VerticalStackLayout>
            <controls:InsetTableView Intent="Settings"
                                     HasUnevenRows="True">
                <TableRoot>
                    <TableSection Title="{x:Static local:Strings.SettingsPage_Notifications}"
                                  TextColor="{StaticResource SecondaryTextColor}">
                        <SwitchCell ios:Cell.DefaultBackgroundColor="{AppThemeBinding Light={StaticResource SecondaryBackgroundColor}, Dark={StaticResource SecondaryBackgroundColorDark}}"
                                    Text="{x:Static local:Strings.SettingsPage_IFPARankChange}"
                                    On="{Binding NotifyOnRankChange, Mode=TwoWay}" />
                        <SwitchCell ios:Cell.DefaultBackgroundColor="{AppThemeBinding Light={StaticResource SecondaryBackgroundColor}, Dark={StaticResource SecondaryBackgroundColorDark}}"
                                    Text="{x:Static local:Strings.SettingsPage_TournamentResultPosted}"
                                    On="{Binding NotifyOnTournamentResult, Mode=TwoWay}" />
                        <SwitchCell ios:Cell.DefaultBackgroundColor="{AppThemeBinding Light={StaticResource SecondaryBackgroundColor}, Dark={StaticResource SecondaryBackgroundColorDark}}"
                                    Text="{x:Static local:Strings.SettingsPage_NewsItemPosted}"
                                    On="{Binding NotifyOnNewBlogPost, Mode=TwoWay}" />
                        <SwitchCell ios:Cell.DefaultBackgroundColor="{AppThemeBinding Light={StaticResource SecondaryBackgroundColor}, Dark={StaticResource SecondaryBackgroundColorDark}}"
                                    Text="{x:Static local:Strings.SettingsPage_NewTournamentOnCalendar}"
                                    On="{Binding NotifyOnNewCalendarEntry, Mode=TwoWay}" />
                    </TableSection>
                    <TableSection Title="{x:Static local:Strings.SettingsPage_MyStats}"
                                  TextColor="{StaticResource SecondaryTextColor}">
                        <ViewCell ios:Cell.DefaultBackgroundColor="{AppThemeBinding Light={StaticResource SecondaryBackgroundColor}, Dark={StaticResource SecondaryBackgroundColorDark}}">
                            <shimmer:SfShimmer x:Name="Shimmer"
                                               VerticalOptions="Fill"
                                               IsVisible="{OnPlatform Android=false}"
                                               IsActive="{Binding IsBusy}"
                                               BackgroundColor="Transparent"
                                               WaveColor="{StaticResource IconAccentColor}"
                                               Fill="{StaticResource SecondaryTextColor}"
                                               Type="CirclePersona">
                                <StackLayout Orientation="Horizontal"
                                             Margin="10">
                                    <toolkit:AvatarView ImageSource="{Binding PlayerAvatar, Mode=OneWay}"
                                                        HorizontalOptions="Center"
                                                        BackgroundColor="{StaticResource ButtonBackgroundColor}"
                                                        BorderWidth="0"
                                                        CornerRadius="8"
                                                        TextColor="{StaticResource ButtonTextColor}" />
                                    <Label Margin="15"
                                           FontSize="18"
                                           HorizontalOptions="StartAndExpand"
                                           IsVisible="{Binding PlayerRecord, Converter={StaticResource notNullConverter}}"
                                           VerticalOptions="Center">
                                        <Label.FormattedText>
                                            <FormattedString>
                                                <Span Text="{Binding PlayerRecord.FirstName}" />
                                                <Span Text="{x:Static local:Strings.SingleSpace}" />
                                                <Span Text="{Binding PlayerRecord.LastName}" />
                                            </FormattedString>
                                        </Label.FormattedText>
                                    </Label>
                                    <Label Text="{x:Static local:Strings.SettingsPage_NoPlayerSelected}"
                                           Margin="15"
                                           FontSize="18"
                                           HorizontalOptions="StartAndExpand"
                                           VerticalOptions="Center"
                                           IsVisible="{Binding PlayerRecord, Converter={StaticResource nullConverter}}" />
                                    <ImageButton IsVisible="{Binding PlayerRecord, Converter={StaticResource notNullConverter}}"
                                                 Source="{mi:Fluent Icon=PersonDelete24, IconColor=Red}"
                                                 Margin="0,0,10,0"
                                                 HorizontalOptions="End"
                                                 Clicked="Button_Clicked" />
                                </StackLayout>
                            </shimmer:SfShimmer>
                        </ViewCell>
                    </TableSection>
                </TableRoot>
            </controls:InsetTableView>
            <!-- TODO: there's a bug in Android where our custom viewcell won't display. so just render below -->
            <shimmer:SfShimmer VerticalOptions="Fill"
                               IsVisible="{OnPlatform false, Android=true}"
                               IsActive="{Binding IsBusy}"
                               BackgroundColor="Transparent"
                               WaveColor="{StaticResource IconAccentColor}"
                               Fill="{StaticResource SecondaryTextColor}"
                               Type="CirclePersona">
                <StackLayout Orientation="Horizontal"
                             Margin="10">
                    <toolkit:AvatarView ImageSource="{Binding PlayerAvatar, Mode=OneWay}"
                                        HorizontalOptions="Center"
                                        BackgroundColor="{StaticResource ButtonBackgroundColor}"
                                        BorderWidth="0"
                                        CornerRadius="8"
                                        TextColor="{StaticResource ButtonTextColor}" />
                    <Label Margin="15"
                           FontSize="18"
                           HorizontalOptions="StartAndExpand"
                           IsVisible="{Binding PlayerRecord, Converter={StaticResource notNullConverter}}"
                           VerticalOptions="Center">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="{Binding PlayerRecord.FirstName}" />
                                <Span Text="{x:Static local:Strings.SingleSpace}" />
                                <Span Text="{Binding PlayerRecord.LastName}" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>
                    <Label Text="{x:Static local:Strings.SettingsPage_NoPlayerSelected}"
                           Margin="15"
                           FontSize="18"
                           HorizontalOptions="StartAndExpand"
                           VerticalOptions="Center"
                           IsVisible="{Binding PlayerRecord, Converter={StaticResource nullConverter}}"/>
                    <ImageButton IsVisible="{Binding PlayerRecord, Converter={StaticResource notNullConverter}}"
                                 Source="{mi:Fluent Icon=PersonDelete24, IconColor=Red}"
                                 Margin="0,0,10,0"
                                 HorizontalOptions="End"
                                 Clicked="Button_Clicked" />
                </StackLayout>
            </shimmer:SfShimmer>
        </VerticalStackLayout>
    </ContentPage.Content>
</ContentPage>